FROM node:18-alpine

# Put build files in /app (not /frontend)
WORKDIR /app

# Copy package files first to leverage Docker cache
COPY package.json yarn.lock ./

# Install dependencies
RUN yarn install

# Copy config files
COPY next.config.ts tsconfig.json postcss.config.js tailwind.config.ts ./

# Copy the rest of the application
COPY . .

# Create source directories
RUN mkdir -p /src/pages /src/styles

# Document that the container will listen on port 3000
EXPOSE 3000

# - ./.next:/src/.next
# - ./db:/src/db
# - ./pages:/src/pages
# - ./public:/src/public
# - ./styles:/src/styles

# Modify the start command to use the source directories
CMD ln -sf /src/.next /app/.next &&  ln -sf /src/db /app/db && ln -sf /src/pages /app/pages && ln -sf /src/public /app/public && ln -sf /src/styles /app/styles && yarn dev
